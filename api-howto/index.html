<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>How-To & Sample Code - streamOS</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "How-To \u0026 Sample Code";
        var mkdocs_page_input_path = "api-howto.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> streamOS
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Platform</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../bot/">The streamOS Bot</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../simulations/">Simulations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../integrations/">Integrations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../reconciliation/">Reconciliation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../overview/">Object Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../customer/">Customer Object</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../product/">Product Object</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Contracts</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../contracts/">Contract Types</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../plans/">Plans</a>
                </li>
                <li class="toctree-l2"><a class="" href="../modifiers.md">Modifiers</a>
                </li>
                <li class="toctree-l2"><a class="" href="../billing.md">Billing Frequency</a>
                </li>
                <li class="toctree-l2"><a class="" href="../contract_examples.md">Examples</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../usage/">Usage Object</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../invoice/">Invoice Object</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../users/">Users</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../c2c/">Use Case - Contract2Cash</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../marketplace.md">Use Case - Marketplace</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../faq/">FAQ & How-To</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" >Developer Documentation</a>
    <ul class="current">
                <li class="toctree-l2"><a class="" href="https://api.streamos.io/swagger-ui">Swagger</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">How-To & Sample Code</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#general-principles">General Principles</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#recursive-contract-construction">Recursive Contract Construction</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#overall-setup-flow">Overall Setup Flow</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#operational-flow">Operational Flow</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#modifications-updates">Modifications &amp; Updates</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#sample-code">Sample Code</a>
    </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tos/">Terms of Service</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../privacy.md">Privacy Policy</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">streamOS</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Platform</li>
          <li class="breadcrumb-item">Developer Documentation</li>
      <li class="breadcrumb-item active">How-To & Sample Code</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="how-to-apis">How to - APIs</h1>
<ol>
<li><a href="#general-principles">General Principles</a><ul>
<li><a href="#recursive-contract-construction">Recursive Contract Construction</a></li>
<li><a href="#overall-setup-flow">Setup Flow</a></li>
<li><a href="#operational-flow">Operational Flow</a></li>
<li><a href="#modifications-&amp;-updates">Modifications and Updates</a></li>
</ul>
</li>
<li><a href="#sample-code">Sample Code</a></li>
</ol>
<h3 id="general-principles">General Principles</h3>
<h6 id="recursive-contract-construction">Recursive Contract Construction</h6>
<p><img alt="Contract-Hierarchy" src="../img/parent_hierarchy.png" /></p>
<p>Constructing objects in streamOS is recursive, start with the lowest in the tree and continue building upwards through the hierarchy. Every reference to a UUID in a POST is an id of an object returned from another POST statement. 
streamOS maintains a factory that it references for all of these objects and links them together on run time. </p>
<p>The Parent Contract is your ultimate tie in to the customer, so until the Parent Contract is created - contracts are orphans. </p>
<p>Plans and Contracts can be reused - so once created you can use them over and over in other create objects for free, by just referencing the id.</p>
<h6 id="overall-setup-flow">Overall Setup Flow</h6>
<p>The overall flow of creation follows this pattern: </p>
<ol>
<li>Create Customers: Create all the customers in streamOS appropriately and store the streamOS customer_ids</li>
<li>Create Products: Create all the customers in streamOS appropriately and store the streamOS customer_ids</li>
<li>Create Contracts: Create the appropriate contract structure that represent your contracts, verify using the UI if required</li>
</ol>
<h6 id="operational-flow">Operational Flow</h6>
<ul>
<li><strong>Structure Usage:</strong> Ensure your usage flow is of the format specified in the /contracts/org_id/usage <a href="https://api.streamos.io/swagger-ui/#/Usage/post_contracts__organization_id__factory_usage">endpoint</a> </li>
<li><strong>Get Charges:</strong> Every update of usage or a contract upload / update triggers a run of the contracts - use the charges <a href="https://api.streamos.io/swagger-ui/#/Contracts/get_contracts__organization_id__factory_charges">endpoint</a> to get the results.</li>
<li><strong>Force a contract run:</strong> if you want to force a contract run trigger <a href="https://api.streamos.io/swagger-ui/#/Contracts/post_contracts__organization_id__factory_run">this</a></li>
</ul>
<h6 id="modifications-updates">Modifications &amp; Updates</h6>
<p><strong>Modifying Contracts:</strong> Modifying contracts in streamOS is tantamount to creating a new contract. You would provide the same information as you did during contract creation to the same endpoint, except for the information that you are changing. Ensure you use the same id as the object you are replacing so that the system knows to replace existing references to it. </p>
<p><strong>Modifying Plans:</strong> Plans are modified in a similar fashion - post the modified information to the same endpoint with the same id to replace a plan definition. However, now that a plan has been changed - call the refresh <a href="https://api.streamos.io/swagger-ui/#/Contracts/options_contracts__organization_id__refresh">endpoint</a> to ensure that all contracts that reference this plan update their local copies of the plan. </p>
<h3 id="sample-code">Sample Code</h3>
<pre><code>import pytest
from flask import json
from app import app
from schema import input, output
import uuid 
import os

org_id = &lt;YOUR_ORG_ID&gt;
auth_token = None

@pytest.fixture
def client():
    global auth_token
    app.config['TESTING'] = True
    with app.test_client() as client:
        if auth_token is None:
            response = client.post('/login', json={'username':&lt;USERNAME&gt;, 'password': &lt;PASSWORD&gt;})
            auth_token = response.json['access_token']
        client.environ_base['HTTP_AUTHORIZATION'] = f'Bearer {auth_token}'
        yield client

#test cases for the /plans/fixedfees endpoint
def test_fixed_fee_no_input(client):
    response = client.post(f'/contracts/{org_id}/plans/fixedfee', json={})
    assert response.status_code == 400

def test_fixed_fee_invalid_input(client):
    # Assuming invalid input structure for demonstration
    invalid_input = {&quot;invalidField&quot;: &quot;invalidValue&quot;}
    response = client.post(f'/contracts/{org_id}/plans/fixedfee', json=invalid_input)
    assert response.status_code == 422
    # Further assertions can be added based on specific validation error messages

def test_fixed_fee_success(client, prefix=''):
    # Assuming valid input structure for demonstration
    valid_input = {
        &quot;display_name&quot;: &quot;Test Fixed Fee&quot;,
        &quot;amount&quot;: 100.0,
        &quot;period&quot;: None
        # Add other required fields according to your FixedFeeSchema
    }
    response = client.post(f'{prefix}/contracts/{org_id}/plans/fixedfee', json=valid_input)
    assert response.status_code == 201
    assert 'amount' in response.json
    assert 'id' in response.json
    assert 'display_name' in response.json
    assert response.json['amount'] == 100.0
    assert response.json['display_name'] == 'Test Fixed Fee'
    # Further assertions can be added to validate the UUID format or other response details
    return response.json['id']

# Test cases for the /plans/tier endpoint
def test_tier_no_input(client):
    response = client.post(f'/contracts/{org_id}/plans/tier', json={})
    assert response.status_code == 400

def test_tier_invalid_input(client):
    # Assuming invalid input structure for demonstration
    invalid_input = {&quot;invalidField&quot;: &quot;invalidValue&quot;}
    response = client.post(f'/contracts/{org_id}/plans/tier', json=invalid_input)
    assert response.status_code == 422
    # Further assertions can be added based on specific validation error messages

def test_tier_invalid_start_value(client):
    # Assuming valid input structure for demonstration
    valid_input = {
        &quot;display_name&quot;: &quot;Test Tier&quot;,
        &quot;tiers&quot;: [[1, 100, 0.1], [101, None, 0.2]],
        &quot;pricing_type&quot;: 1,
        &quot;period&quot;: &quot;1D&quot;
        # Add other required fields according to your TierSchema
    }
    response = client.post(f'/contracts/{org_id}/plans/tier', json=valid_input)
    assert response.status_code == 400, f'Received: {response.json}'


def test_tier_invalid_end_value(client):
    # Assuming valid input structure for demonstration
    valid_input = {
        &quot;display_name&quot;: &quot;Test Tier&quot;,
        &quot;tiers&quot;: [[0, 100, 0.1], [101, 201, 0.2]],
        &quot;pricing_type&quot;: 1,
        &quot;period&quot;: &quot;1D&quot;
        # Add other required fields according to your TierSchema
    }
    response = client.post(f'/contracts/{org_id}/plans/tier', json=valid_input)
    assert response.status_code == 400


def test_tier_success(client, prefix=''):
    # Assuming valid input structure for demonstration
    valid_input = {
        &quot;display_name&quot;: &quot;Test Tier&quot;,
        &quot;tiers&quot;: [[0, 100, 0.1], [101, None, 0.2]],
        &quot;pricing_type&quot;: 1
        # Add other required fields according to your TierSchema
    }
    response = client.post(f'{prefix}/contracts/{org_id}/plans/tier', json=valid_input)
    assert response.status_code == 201
    # Assuming the response includes a UUID
    assert 'id' in response.json
    # Further assertions can be added to validate the UUID format or other response details
    return response.json['id']

# Test cases for the /modifiers/discounts endpoint
def test_discount_no_input(client):
    response = client.post(f'/contracts/{org_id}/modifiers/discounts', json={})
    assert response.status_code == 400

def test_discount_invalid_input(client):
    # Assuming invalid input structure for demonstration
    invalid_input = {&quot;invalidField&quot;: &quot;invalidValue&quot;}
    response = client.post(f'/contracts/{org_id}/modifiers/discounts', json=invalid_input)
    assert response.status_code == 422
    # Further assertions can be added based on specific validation error messages

def test_discount_success(client, prefix=''):
    # Assuming valid input structure for demonstration
    valid_input = {
        &quot;display_name&quot;: &quot;Test Discount&quot;,
        &quot;percentage&quot;: 10.0,
        &quot;threshold&quot;: 100.0
        # Add other required fields according to your DiscountSchema
    }
    response = client.post(f'{prefix}/contracts/{org_id}/modifiers/discounts', json=valid_input)
    assert response.status_code == 201
    # Assuming the response includes a UUID
    assert 'id' in response.json
    assert 'percentage' in response.json
    assert 'threshold' in response.json
    # Further assertions can be added to validate the UUID format or other
    return response.json['id']

def test_billing_frequency_no_input(client):
    response = client.post(f'/contracts/{org_id}/modifiers/billing_frequency', json={})
    assert response.status_code == 400

def test_billing_frequency_invalid_input(client):
    # Assuming invalid input structure for demonstration
    invalid_input = {&quot;invalidField&quot;: &quot;invalidValue&quot;}
    response = client.post(f'/contracts/{org_id}/modifiers/billing_frequency', json=invalid_input)
    assert response.status_code == 422
    # Further assertions can be added based on specific validation error messages

def test_billing_frequency_success(client, prefix=''):
    # Assuming valid input structure for demonstration
    valid_input = {
        &quot;display_name&quot;: &quot;Test Billing Frequency&quot;,
        &quot;type&quot;: 1,
        &quot;interval&quot;: 1,
        &quot;frequency&quot;: &quot;D&quot;,
        &quot;anchor&quot;: &quot;S&quot;,
        &quot;eq&quot;: False
        # Add other required fields according to your BillingFrequencySchema
    }
    response = client.post(f'{prefix}/contracts/{org_id}/modifiers/billing_frequency', json=valid_input)
    assert response.status_code == 201
    # Assuming the response includes a UUID
    assert 'id' in response.json
    assert 'display_name' in response.json
    assert 'type' in response.json
    assert 'interval' in response.json
    assert 'frequency' in response.json
    assert 'anchor' in response.json
    assert 'eq' in response.json
    # Further assertions can be added to validate the UUID format or other response details
    return response.json['id']

def test_billing_frequency_sim_dates(client):
    # Assuming valid input structure for demonstration
    valid_input = {
        &quot;display_name&quot;: &quot;Test Billing Frequency&quot;,
        &quot;type&quot;: 1,
        &quot;interval&quot;: 1,
        &quot;frequency&quot;: &quot;M&quot;,
        &quot;anchor&quot;: &quot;S&quot;,
        &quot;eq&quot;: False,
        &quot;start_date&quot;: &quot;2023-01-01T00:00:00&quot;,
        &quot;end_date&quot;: &quot;2023-12-31T23:59:59&quot;
        # Add other required fields according to your BillingFrequencySchema
    }
    response = client.post(f'/contracts/{org_id}/modifiers/billing_frequency/sim_dates', json=valid_input)
    assert response.status_code == 200, f'Received: {response.json}'
    # Assuming the response includes a UUID
    assert 'dates' in response.json, f'Received: {response.json}'


def test_minimum_no_input(client):
    response = client.post(f'/contracts/{org_id}/modifiers/minimums', json={})
    assert response.status_code == 400

def test_minimum_invalid_input(client):
    # Assuming invalid input structure for demonstration
    invalid_input = {&quot;invalidField&quot;: &quot;invalidValue&quot;}
    response = client.post(f'/contracts/{org_id}/modifiers/minimums', json=invalid_input)
    assert response.status_code == 422
    # Further assertions can be added based on specific validation error messages

def test_minimum_success(client, prefix=''):
    # Assuming valid input structure for demonstration
    valid_input = {
        &quot;display_name&quot;: &quot;Test Minimum&quot;,
        &quot;amount&quot;: 100.0
        # Add other required fields according to your MinimumSchema
    }
    response = client.post(f'{prefix}/contracts/{org_id}/modifiers/minimums', json=valid_input)
    assert response.status_code == 201
    # Assuming the response includes a UUID
    assert 'id' in response.json
    # Further assertions can be added to validate the UUID format or other response details
    return response.json['id']

#test cases for the /contracts/productcontract endpoint
def test_product_pricing_no_input(client):
    response = client.post(f'/contracts/{org_id}/productcontract', json={})
    assert response.status_code == 400
    assert response.json == {'message': 'No input data provided'}

def test_product_pricing_invalid_input(client):
    # Assuming invalid input structure for demonstration
    invalid_input = {&quot;invalidField&quot;: &quot;invalidValue&quot;}
    response = client.post(f'/contracts/{org_id}/productcontract', json=invalid_input)
    assert response.status_code == 422, f'Received: {response.json}'
    # Further assertions can be added based on specific validation error messages

def test_product_pricing_success(client, prefix=''):
    # Assuming valid input structure for demonstration
    tier_uuid = test_tier_success(client, prefix)
    billing_uuid = test_billing_frequency_success(client, prefix)
    valid_input = {
        &quot;display_name&quot;: &quot;Test Product Contract&quot;,
        &quot;start_date&quot;: &quot;2023-01-01T00:00:00&quot;,
        &quot;end_date&quot;: &quot;2023-12-31T23:59:59&quot;,
        &quot;billing_frequency&quot;: billing_uuid,
        &quot;tiers&quot;: tier_uuid,
        &quot;product_id&quot;: uuid.uuid4()
        # Add other required fields according to your ProductContractSchema
    }
    response = client.post(f'{prefix}/contracts/{org_id}/productcontract', json=valid_input)
    assert response.status_code == 201, f'Received: {response.json}'
    # Assuming the response includes a UUID
    assert 'id' in response.json, f'Received: {response.json}'
    assert 'billing_frequency' in response.json, f'Received: {response.json}'
    assert 'tiers' in response.json, f'Received: {response.json}'
    # Further assertions can be added to validate the UUID format or other response details
    return response.json['id']

#testcases for the /contracts/subcontract endpoint
def test_subcontract_no_input(client):
    response = client.post(f'/contracts/{org_id}/subcontract', json={})
    assert response.status_code == 400
    assert response.json == {'message': 'No input data provided'}

def test_subcontract_invalid_input(client):
    # Assuming invalid input structure for demonstration
    invalid_input = {&quot;invalidField&quot;: &quot;invalidValue&quot;}
    response = client.post(f'/contracts/{org_id}/subcontract', json=invalid_input)
    assert response.status_code == 422, f'Received: {response.json}'
    # Further assertions can be added based on specific validation error messages

def test_subcontract_bad_objects(client):
    # Assuming valid input structure for demonstration
    billing_frequency_uuid = test_billing_frequency_success(client)
    valid_input = {
        &quot;display_name&quot;: &quot;Test Subcontract&quot;,
        &quot;start_date&quot;: &quot;2023-01-01T00:00:00&quot;,
        &quot;end_date&quot;: &quot;2023-12-31T23:59:59&quot;,
        &quot;billing_frequency&quot;: billing_frequency_uuid,
        &quot;minimums&quot;: uuid.uuid4(),
        &quot;discounts&quot;: uuid.uuid4(),
        &quot;product_contracts&quot;: [uuid.uuid4()],
        &quot;fixed_fees&quot;: [uuid.uuid4()],
        &quot;sub_contracts&quot;: [uuid.uuid4()],
        &quot;override_underlying&quot;: False
        # Add other required fields according to your ContractSchema
    }
    response = client.post(f'/contracts/{org_id}/subcontract', json=valid_input)
    assert response.status_code == 422, f'Received: {response.json}'

def test_subcontract_success(client, prefix=''):
    # Assuming valid input structure for demonstration
    minimum_uuid = test_minimum_success(client, prefix)
    discount_uuid = test_discount_success(client, prefix)
    product_contract_uuid = test_product_pricing_success(client, prefix)
    fixed_fee_uuid = test_fixed_fee_success(client, prefix)
    billing_frequency_uuid = test_billing_frequency_success(client, prefix)
    credit_uuid = test_credit_success(client, prefix)
    valid_input = {
        &quot;display_name&quot;: &quot;Test Subcontract&quot;,
        &quot;start_date&quot;: &quot;2023-01-01T00:00:00&quot;,
        &quot;end_date&quot;: &quot;2023-12-31T23:59:59&quot;,
        &quot;billing_frequency&quot;: billing_frequency_uuid,
        &quot;minimums&quot;: minimum_uuid,
        &quot;discounts&quot;: discount_uuid,
        &quot;product_contracts&quot;: [product_contract_uuid],
        &quot;fixed_fees&quot;: [fixed_fee_uuid],
        &quot;credits&quot;: credit_uuid,
        &quot;override_underlying&quot;: False
        # Add other required fields according to your ContractSchema
    }
    response = client.post(f'{prefix}/contracts/{org_id}/subcontract', json=valid_input)
    assert response.status_code == 201, f'Received: {response.json}'
    # Assuming the response includes a UUID
    assert 'id' in response.json, f'Received: {response.json}'
    assert 'billing_frequency' in response.json, f'Received: {response.json}'
    assert 'minimums' in response.json, f'Received: {response.json}'
    assert 'discounts' in response.json, f'Received: {response.json}'
    assert 'product_contracts' in response.json, f'Received: {response.json}'
    assert 'fixed_fees' in response.json, f'Received: {response.json}'
    assert 'credits' in response.json, f'Received: {response.json}'
    assert response.json['display_name'] == 'Test Subcontract', f'Received: {response.json}'
    # Further assertions can be added to validate the UUID format or other response details
    return response.json['id']

#testcases for the /contracts/parentcontract endpoint
def test_parent_contract_no_input(client):
    response = client.post(f'/contracts/{org_id}/parentcontract', json={})
    assert response.status_code == 400
    assert response.json == {'message': 'No input data provided'}

def test_parent_contract_invalid_input(client):
    # Assuming invalid input structure for demonstration
    invalid_input = {&quot;invalidField&quot;: &quot;invalidValue&quot;}
    response = client.post(f'/contracts/{org_id}/parentcontract', json=invalid_input)
    assert response.status_code == 422, f'Received: {response.json}'
    # Further assertions can be added based on specific validation error messages

def test_parent_contract_success(client, prefix=''):
    # Assuming valid input structure for demonstration

    product_contract_uuid = test_product_pricing_success(client, prefix)
    fixed_fee_uuid = test_fixed_fee_success(client, prefix)
    sub_contract_uuid = test_subcontract_success(client, prefix)
    billing_frequency_uuid = test_billing_frequency_success(client, prefix)
    credit_uuid = test_credit_success(client, prefix)
    valid_input = {
        &quot;organization_id&quot;: org_id,
        &quot;customer_id&quot;: uuid.uuid4(),
        &quot;display_name&quot;: &quot;Test Parent Contract&quot;,
        &quot;start_date&quot;: &quot;2023-01-01T00:00:00&quot;,
        &quot;end_date&quot;: &quot;2023-12-31T23:59:59&quot;,
        &quot;billing_frequency&quot;: billing_frequency_uuid,
        &quot;product_contracts&quot;: [product_contract_uuid],
        &quot;credits&quot;: credit_uuid,
        &quot;fixed_fees&quot;: [fixed_fee_uuid],
        &quot;sub_contracts&quot;: [sub_contract_uuid],
        &quot;override_underlying&quot;: False
        # Add other required fields according to your ParentContractSchema
    }
    response = client.post(f'{prefix}/contracts/{org_id}/parentcontract', json=valid_input)
    assert response.status_code == 201, f'Received: {response.json}'
    # Assuming the response includes a UUID
    assert 'id' in response.json, f'Received: {response.json}'
    assert 'billing_frequency' in response.json, f'Received: {response.json}'
    assert 'product_contracts' in response.json, f'Received: {response.json}'
    assert 'fixed_fees' in response.json, f'Received: {response.json}'
    assert 'sub_contracts' in response.json, f'Received: {response.json}'
    assert 'credits' in response.json, f'Received: {response.json}'
    # Further assertions can be added to validate the UUID format or other response details
    return response.json['id']

def test_credit_no_input(client):
    response = client.post(f'/contracts/{org_id}/modifiers/credits', json={})
    assert response.status_code == 400
    assert response.json == {'message': 'No input data provided'}

def test_credit_invalid_input(client):
    # Assuming invalid input structure for demonstration
    invalid_input = {&quot;invalidField&quot;: &quot;invalidValue&quot;}
    response = client.post(f'/contracts/{org_id}/modifiers/credits', json=invalid_input)
    assert response.status_code == 422, f'Received: {response.json}'
    # Further assertions can be added based on specific validation error messages

def test_credit_success(client, prefix=''):
    # Assuming valid input structure for demonstration
    valid_input = {
        &quot;display_name&quot;: &quot;Test Credit&quot;,
        &quot;amount&quot;: 100.0,
        &quot;expiry&quot;: &quot;1Y&quot;
        # Add other required fields according to your CreditSchema
    }
    response = client.post(f'{prefix}/contracts/{org_id}/modifiers/credits', json=valid_input)
    assert response.status_code == 201, f'Received: {response.json}'
    # Assuming the response includes a UUID
    assert 'id' in response.json, f'Received: {response.json}'
    assert 'expiry' in response.json, f'Received: {response.json}'
    assert 'display_name' in response.json, f'Received: {response.json}'
    assert 'amount' in response.json, f'Received: {response.json}'
    # Further assertions can be added to validate the UUID format or other response details
    return response.json['id']

def test_get_credits(client):
    credit_uuid = test_credit_success(client)
    response = client.get(f'/contracts/{org_id}/modifiers/credits')
    assert response.status_code == 200
    assert isinstance(response.json, list) and len(response.json) == 1, f'Received: {response.json}'
    assert (response.json[0])['id'] == credit_uuid, f'Received: {response.json}'

def test_get_credit_success(client):
    credit_uuid = test_credit_success(client)
    response = client.get(f'/contracts/{org_id}/modifiers/credit/{credit_uuid}')
    assert response.status_code == 200
    assert response.json['id'] == credit_uuid, f'Received: {response.json}'
    assert response.json['display_name'] == 'Test Credit', f'Received: {response.json}'
    assert response.json['amount'] == 100.0, f'Received: {response.json}'
    assert response.json['expiry'] == '1Y', f'Received: {response.json}'

def test_tiers(client):
    tier_uuid = test_tier_success(client)
    response = client.get(f'/contracts/{org_id}/plans/tiers')
    assert response.status_code == 200
    assert isinstance(response.json, list) and len(response.json) == 1, f'Received: {response.json}'
    assert (response.json[0])['id'] == tier_uuid, f'Received: {response.json}'

def test_nonexistent_tier(client):
    uuid = '00000000-0000-0000-0000-000000000000'
    response = client.get(f'/contracts/{org_id}/plans/tier/{uuid}')
    assert response.status_code == 404

def test_get_tier_success(client):
    tier_ = test_tier_success(client)
    response = client.get(f'/contracts/{org_id}/plans/tier/{tier_}')
    assert response.status_code == 200
    assert response.json['id'] == tier_, f'Received: {response.json}'
    assert response.json['display_name'] == 'Test Tier', f'Received: {response.json}'
    assert response.json['tier'] == [[0, 100, 0.1], [101, None, 0.2]], f'Received: {response.json}'
    assert response.json['pricing_type'] == 1, f'Received: {response.json}'

#test cases for the /plans/fixedfees endpoint GET method
def test_get_empty_fixed_fees(client):
    response = client.get(f'/contracts/{org_id}/plans/fixedfees')
    assert response.status_code == 200

    assert isinstance(response.json, list) and len(response.json) == 0, f'Received: {response.json}'

def test_nonexistent_fixed_fee(client):
    uuid = '00000000-0000-0000-0000-000000000000'
    response = client.get(f'/contracts/{org_id}/plans/fixedfee/{uuid}')
    assert response.status_code == 404

def test_get_fixed_fee_success(client):
    fixed_fee_uuid = test_fixed_fee_success(client)
    response = client.get(f'/contracts/{org_id}/plans/fixedfee/{fixed_fee_uuid}')
    assert response.status_code == 200
    assert response.json['id'] == fixed_fee_uuid, f'Received: {response.json}'
    assert response.json['amount'] == 100.0, f'Received: {response.json}'
    assert response.json['period'] == None, f'Received: {response.json}'
    assert response.json['display_name'] == 'Test Fixed Fee', f'Received: {response.json}'

def test_fixed_fees(client):
    fixed_fee_uuid = test_fixed_fee_success(client)
    response = client.get(f'/contracts/{org_id}/plans/fixedfees')
    assert response.status_code == 200
    assert isinstance(response.json, list) and len(response.json) == 1, f'Received: {response.json}'
    assert (response.json[0])['id'] == fixed_fee_uuid, f'Received: {response.json}'

def test_get_discount_success(client):
    discount_uuid = test_discount_success(client)
    response = client.get(f'/contracts/{org_id}/modifiers/discount/{discount_uuid}')
    assert response.status_code == 200
    assert response.json['id'] == discount_uuid, f'Received: {response.json}'
    assert response.json['percentage'] == 10.0, f'Received: {response.json}'
    assert response.json['threshold'] == 100.0, f'Received: {response.json}'
    assert response.json['display_name'] == 'Test Discount', f'Received: {response.json}'

def test_discounts(client):
    discount_uuid = test_discount_success(client)
    response = client.get(f'/contracts/{org_id}/modifiers/discounts')
    assert response.status_code == 200
    assert isinstance(response.json, list) and len(response.json) == 1, f'Received: {response.json}'
    assert (response.json[0])['id'] == discount_uuid, f'Received: {response.json}'

#test cases for the /modifiers/minimums endpoint GET method
def test_get_empty_minimums(client):
    response = client.get(f'/contracts/{org_id}/modifiers/minimums')
    assert response.status_code == 200

    assert not response.json, f'Received: {response.json}'

def test_get_minimum_success(client):
    minimum_uuid = test_minimum_success(client)
    response = client.get(f'/contracts/{org_id}/modifiers/minimum/{minimum_uuid}')
    assert response.status_code == 200
    assert response.json['id'] == minimum_uuid, f'Received: {response.json}'
    assert response.json['amount'] == 100.0, f'Received: {response.json}'
    assert response.json['display_name'] == 'Test Minimum', f'Received: {response.json}'

def test_get_billing_frequency_success(client):
    billing_frequency_uuid = test_billing_frequency_success(client)
    response = client.get(f'/contracts/{org_id}/modifiers/billing_frequency/{billing_frequency_uuid}')
    assert response.status_code == 200
    assert response.json['id'] == billing_frequency_uuid, f'Received: {response.json}'
    assert response.json['display_name'] == 'Test Billing Frequency', f'Received: {response.json}'
    assert response.json['type'] == 1, f'Received: {response.json}'
    assert response.json['interval'] == 1, f'Received: {response.json}'
    assert response.json['frequency'] == 'D', f'Received: {response.json}'
    assert response.json['anchor'] == 'S', f'Received: {response.json}'
    assert response.json['eq'] == False, f'Received: {response.json}'

def test_billing_frequencies(client):
    billing_frequency_uuid = test_billing_frequency_success(client)
    response = client.get(f'/contracts/{org_id}/modifiers/billing_frequencies')
    assert response.status_code == 200
    assert isinstance(response.json, list) and len(response.json) == 1, f'Received: {response.json}'
    assert (response.json[0])['id'] == billing_frequency_uuid, f'Received: {response.json}'


def test_get_contract_success(client):
    parent_contract_uuid = test_parent_contract_success(client)
    response = client.get(f'/contracts/{org_id}/contract/{parent_contract_uuid}')
    assert response.status_code == 200
    assert response.json['id'] == parent_contract_uuid, f'Received: {response.json}'
    assert response.json['display_name'] == 'Test Parent Contract', f'Received: {response.json}'
    assert response.json['override_underlying'] == False, f'Received: {response.json}'
    assert all(k in response.json for k in ['organization_id' ,'customer_id', 'minimums', 'discounts', 'product_contracts', 'fixed_fees', 'sub_contracts']), f'Received: {response.json}'

def test_get_contracts_by_customer_success(client):
    parent_contract_uuid = test_parent_contract_success(client)
    response = client.get(f'/contracts/{org_id}/contract/{parent_contract_uuid}')
    customer_id = (response.json)['customer_id']
    response = client.get(f'/contracts/{org_id}/customer/{customer_id}')
    assert response.status_code == 200
    assert isinstance(response.json, list) and len(response.json) == 1, f'Received: {response.json}'
    assert (response.json[0])['id'] == parent_contract_uuid, f'Received: {response.json}'

def test_factory_run(client):
    response = client.post(f'/contracts/{org_id}/factory/run', json={})
    assert response.status_code == 200, f'Received: {response.json}'

def test_customer_create_success(client):
    response = client.post(f'/contracts/{org_id}/customers', json={'customer_name': 'Test Customer', 'customer_email': 'test@test.com'})
    assert response.status_code == 201
    assert 'customer_id' in response.json
    assert 'customer_name' in response.json
    assert response.json['customer_name'] == 'Test Customer'
    return response.json['customer_id']

def test_customer_get_success(client):
    customer_id = test_customer_create_success(client)
    response = client.get(f'/contracts/{org_id}/customers/{customer_id}')
    assert response.status_code == 200
    assert response.json['customer_id'] == customer_id
    assert response.json['customer_name'] == 'Test Customer'
    assert response.json['customer_email'] == 'test@test.com'


def test_customer_update_success(client):
    customer_id = test_customer_create_success(client)
    response = client.put(f'/contracts/{org_id}/customers/{customer_id}', json={'customer_name': 'Updated Customer', 'customer_email': 'test@test.com'})
    assert response.status_code == 200
    assert response.json['customer_id'] == customer_id


def test_sim_factory_run(client):
    parent_contract_uuid = test_parent_contract_success(client, prefix='/sim')
    response = client.get(f'/sim/contracts/{org_id}/contract/{parent_contract_uuid}')
    product_id = response.json['product_contracts'][0]['product_id']
    product_contract_id = response.json['product_contracts'][0]['id']
    response = client.post(f'/sim/contracts/{org_id}/factory/run', json={'usage': [{'date': '2024-02-29', 'product_id': product_id, 'contract_id': product_contract_id, 'quantity': 100}] })
    assert response.status_code == 200, f'Received: {response.json}'
    response = client.get(f'/sim/contracts/{org_id}/factory/charges')
    assert response.status_code == 200, f'Received: {response.json}'
    assert isinstance(response.json, list), f'Received: {response.json}'


</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../faq/" class="btn btn-neutral float-left" title="FAQ & How-To"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../tos/" class="btn btn-neutral float-right" title="Terms of Service">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../faq/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../tos/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
